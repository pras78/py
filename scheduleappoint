from breezypythongui import EasyFrame
from tkinter import *
from functools import partial
import random
import calendar
import datetime
from datetime import datetime, timedelta

win = Tk()
button_identities = []
button_identities2 = []
#doc1List = []

class DoctorOffice(EasyFrame):
    """Displays a greeting in a window"""
    #global doctor
   
  
    COLOR="#CCCCFF"
    def __init__(self):
        """Sets up the window and the label"""
        EasyFrame.__init__(self,title="Schedule Appointment")
                           #background=DoctorOffice.COLOR)

        today = datetime.now().date()
        global doc1List
        global doc2List
        doc1List=[]
        global apptDoc1List
        apptDoc1List=[]

       #Adding elements inside a list 
        for i in range(0,7):
            j=8
            for k in range(0,9):
                if(j<12):
                    element=str((today.strftime('%Y-%m-%d') + " "+(str(j)+" AM")))
                    doc1List.append(element)
                elif(j>13):
                     element=str((today.strftime('%Y-%m-%d') +" "+(str(j)+" PM")))
                     doc1List.append(element)
                j+=1
                
            dayOfWeek=((today).weekday())
            if dayOfWeek <=4:
                today=today+timedelta(days=1)
            elif dayOfWeek > 4:
                print(today)
                if(dayOfWeek ==5):
                    today=today+timedelta(days=2)
                    #print("hello: "+str(today))
                elif (dayOfWeek ==6):
                    today=today+timedelta(days=1)
                    #print("hello: "+str(today))
        #print("-----"+str(button_identities))

        print("Printing the doclist")
        
        doc2List=doc1List.copy()
        for k in doc2List:
            print(k)
        print("end of doclist")
        


        #add a button to schedule new patient
        #self.addLabel(text = "Please select option below to schedule appointment ", row=1, column=0,background=DoctorOffice.COLOR)
        #message1=self.addButton(text = "Create new appointment", row = 7, column = 0,  columnspan = 3,command = self.selectDoctor)

        def schedulePatient(self):    
            self.addLabel(text = "Select Doctor's name: ", row=1, column=0)#,background=DoctorOffice.COLOR)
            self.doctorGroup = self.addRadiobuttonGroup(row = 2,  column = 0,  rowspan = 2)
            self.doctorGroup.addRadiobutton(text = "Dr. Jeff")
            #self.doctorGroup.setSelectedButton(defaultRB)
            self.doctorGroup.addRadiobutton(text = "Dr. Morris")
            self.doctorGroup.addRadiobutton(text = "Dr. Alison")
            self.doctorGroup.addRadiobutton(text = "Dr. Karen")
            self.doctorGroup.addRadiobutton(text = "Dr. Daniel")

            message1=self.addButton(text = "Select Doctor", row = 7, column = 0,  columnspan = 3,command = self.selectDoctor)
            self.addLabel(text = "Select Date: ", row=8, column=0)#,background=DoctorOffice.COLOR)
            self.addLabel(text=calendar.month(2019,6), row=9, column=0)
            today=datetime.now().date()
            print(today)        
            today = datetime.now().date()
            for i in range(0,7):
                #print("i: "+str(i))
                #print("Today is: "+str((today.weekday())))
                
                button = Button(win, width=10, text=str(today), command=partial(change, i, today))
                button.grid(column=i, row=12)
                #button.pack()
                # add the button's identity to a list:
                button_identities.append(button)

                # just to show what happens:
                #print(button_identities)
                dayOfWeek=((today).weekday())
                if dayOfWeek <=4:
                    #print("Weekday: "+ str(today))
                    today=today+timedelta(days=1)
                elif dayOfWeek > 4:
                    print(today)
                    if(dayOfWeek ==5):
                        today=today+timedelta(days=2)
                        #print("hello: "+str(today))
                    elif (dayOfWeek ==6):
                        today=today+timedelta(days=1)
                        #print("hello: "+str(today))
            #print("-----"+str(button_identities))

        def getPatientDetails(self):
            self.addLabel(text = "Enter Patient's name", row=2, column=5,background=DoctorOffice.COLOR)
            self.PatientName = self.addTextField(text="",row = 3,  column = 5, width=25,rowspan=1, columnspan=1)
            self.addButton(text = "Schedule Appointment", row = 4, column = 5,  columnspan = 2,  command = self.scheduleAppointment)

        def scheduleAppointment(self):
            schedulePatient=self.PatientName.getText()
            print(schedulePatient)
            times=timeSel
            for availTimes in doc1List:
                if(availTimes.find(times)==0):
                    apptDoc1List.append([times,schedulePatient])
                    doc1List.remove(times)
                    print(apptDoc1List)
            self.PatientName.delete(0, "end")
            import pdb;pdb.set_trace()
            self.doctorGroup.selection_clear()
                
        k=self.schedulePatient()
        getPatientDetails(self)
        
        
    def selectDoctor(self):
        """Display a message box with the order information."""
        # add error message for not selecting a doctor
        global doctor
        global doctorIndex
        message =  "You selected: "
        message += self.doctorGroup.getSelectedButton()["text"]
        self.messageBox(title = "Doctor Selection",  message = message)
        print(self.doctorGroup.getSelectedButton()["text"])
        print("Trying to print index: "+str(self.doctorGroup.getSelectedButton()))
        print(type(self.doctorGroup.getSelectedButton()))
        doctor= str(self.doctorGroup.getSelectedButton()["text"])
        stringVal=str(self.doctorGroup.getSelectedButton())
        print(stringVal)
        doctorIndex=(stringVal.split("radiobuttongroup.!")[1])
        print(doctorIndex)              
        return doctor

   
        
    


            
        
 
    
        

def change(n,today):
    # function to get the index and the identity (bname)
    print(n)
    bname = (button_identities[n])
    bname.configure(text = "Selected")
    #print(today)
    #print(type(today))
    #print(self)
    pickDoctor(today)
    
    
def pickDoctor(today):
    #print(n)
    #bname = (button_identities[n])
    #bname.configure(text = "Selected")
    print(today)
    print(doctor)
    print(doctorIndex)
    availableTimes(today)
    #bookDoctor(today)
    

def bookDoctor(n,times):
    print(times+" We got here")
    print(n)
    bname2 = (button_identities2[n])
    bname2.configure(text = "Selected")
    global timeSel
    timeSel=times
    # label for collecting patient's name, phone number
    #win.Label(text = "Enter Patient's name", row=16, column=0,background=DoctorOffice.COLOR)
    #self.PatientName = self.addTextField(text="",row = 17,  column = 2, width=25,rowspan=1, columnspan=1)
    
##    for availTimes in doc1List:
##        if(availTimes.find(times)==0):
##            apptDoc1List.append(times,PatientName)
##            doc1List.remove(times)
##            print(apptDoc1List)
    

def availableTimes(today):
    print("In available times:")
    if(doctorIndex == 'radiobutton'):
        print(today)
        i=1
        
        for times in doc1List:
            if(times.find(str(today))==0):
               print(times)
               button = Button(win, width=15, text=str(times), command=partial(bookDoctor, i, times))
               button.grid(column=i, row=15)
               i+=1
                #button.pack()
                # add the button's identity to a list:
               button_identities2.append(button)
           
        
        
    #if(doctorIndex == 'radiobutton2'): 
    
def main():
    DoctorOffice().mainloop()
if __name__ == "__main__": main()

        
